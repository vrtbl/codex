<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Pattern Matching - The Passerine Codex</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../preface.html"><strong aria-hidden="true">1.</strong> A Short Preface</a></li><li class="chapter-item expanded "><a href="../road-ahead.html"><strong aria-hidden="true">2.</strong> The Road Ahead</a></li><li class="chapter-item expanded "><a href="../getting-started/getting-started.html"><strong aria-hidden="true">3.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/installation.html"><strong aria-hidden="true">3.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="../getting-started/hello-world.html"><strong aria-hidden="true">3.2.</strong> Hello, World!</a></li></ol></li><li class="chapter-item expanded "><a href="../core/core.html"><strong aria-hidden="true">4.</strong> The Core Language</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../core/syntax.html"><strong aria-hidden="true">4.1.</strong> Syntax</a></li><li class="chapter-item expanded "><a href="../core/a-quick-example.html"><strong aria-hidden="true">4.2.</strong> A Quick(sort) Example</a></li><li class="chapter-item expanded "><a href="../core/function-application.html"><strong aria-hidden="true">4.3.</strong> Function Application</a></li><li class="chapter-item expanded "><a href="../core/pattern-matching.html" class="active"><strong aria-hidden="true">4.4.</strong> Pattern Matching</a></li><li class="chapter-item expanded "><a href="../core/fibers.html"><strong aria-hidden="true">4.5.</strong> Fibers</a></li><li class="chapter-item expanded "><a href="../core/error-handling.html"><strong aria-hidden="true">4.6.</strong> Error Handling</a></li><li class="chapter-item expanded "><a href="../core/macros.html"><strong aria-hidden="true">4.7.</strong> Macros</a></li><li class="chapter-item expanded "><a href="../core/match-from-scratch.html"><strong aria-hidden="true">4.8.</strong> Match From Scratch</a></li><li class="chapter-item expanded "><a href="../core/modules.html"><strong aria-hidden="true">4.9.</strong> Modules</a></li></ol></li><li class="chapter-item expanded "><a href="../concluding-thoughts.html"><strong aria-hidden="true">5.</strong> Concluding Thoughts</a></li><li class="chapter-item expanded "><a href="../faq.html"><strong aria-hidden="true">6.</strong> Frequently Asked Questions</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Passerine Codex</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="pattern-matching"><a class="header" href="#pattern-matching">Pattern Matching</a></h2>
<p>In the last section, we touched on pattern matching a little. I hope to now go one step further and build a strong argument as to why pattern matching in Passerine is such a powerful construct. Patterns are used in in three places:</p>
<ol>
<li>Assignments,</li>
<li>Functions,</li>
<li>and Type Definitions.</li>
</ol>
<p>We'll briefly discuss each type of pattern and the context in which they are used.</p>
<h3 id="what-are-patterns"><a class="header" href="#what-are-patterns">What are patterns?</a></h3>
<p><em>Patterns</em> extract <em>data</em> from <em>types</em> by mirroring the structure of those types. The act of applying a pattern to a type is called <em>matching</em> or <em>destructuring</em> – when a pattern matches some data successfully, a number of <em>bindings</em> are produced.</p>
<p>Passerine supports algebraic data types, and all of these types can be matched and destructured against. Here is a table of Passerine's patterns:</p>
<blockquote>
<p>In the following table, <code>p</code> is a nested sub-pattern.</p>
</blockquote>
<table><thead><tr><th>pattern</th><th>example</th><th>destructures</th></tr></thead><tbody>
<tr><td>variable</td><td><code>foo</code></td><td>Terminal pattern, binds an variable to a value.</td></tr>
<tr><td>data</td><td><code>420.69</code></td><td>Terminal pattern,  data that <em>must</em> match, raises an error otherwise. See the following section on fibers and concurrency to get an idea of how errors work in Passerine.</td></tr>
<tr><td>discard</td><td><code>_</code></td><td>Terminal pattern, matches any data, does not produce a binding.</td></tr>
<tr><td>label</td><td><code>Baz p</code></td><td>Matches a label, i.e. a named <em>type</em> in Passerine.</td></tr>
<tr><td>tuple</td><td><code>(p₀, ...)</code></td><td>Matches each element of a tuple, which is a group of elements, of potentially different types. Unit <code>()</code> is the empty tuple.</td></tr>
<tr><td>list</td><td><code>[]</code>/<code>[p₀, ..p₁]</code></td><td><code>[]</code> Matches an empty list - <code>p₀</code> matches the head of a list, <code>..p₁</code> matches the tail.</td></tr>
<tr><td>record</td><td><code>{f₀: p₀, ...}</code></td><td>A record, i.e. a struct. This is a series of field-pattern pairs. If a field does not exist in the target record, an error is raised.</td></tr>
<tr><td>enum</td><td><code>{p₀; ...}</code></td><td>An enumeration, i.e. a union. Matches if any of the patterns hold.</td></tr>
<tr><td>is</td><td><code>p₀: p₁</code></td><td>A type annotation. Matches against <code>p₀</code> only if <code>p₁</code> holds, errors otherwise.</td></tr>
<tr><td>where</td><td><code>p \| e</code></td><td>A bit different from the other patterns so far. Matches <code>p</code> only if the expression <code>e</code> is true.</td></tr>
</tbody></table>
<p>That's quite a lot of information, so let's work through it. The simplest case is a standard assignment:</p>
<pre><code class="language-elm">a = b
-- produces the binding a = b
</code></pre>
<p>This is very straightforward and we've already covered this, so let's begin by discussing matching against <em>data</em>. The following function will return the second argument if the first argument passed to the function is <code>true</code>.</p>
<pre><code class="language-elm">true second -&gt; second
</code></pre>
<p>If the first argument is not true, say <code>false</code>, Passerine will yell at us:</p>
<pre><code>Fatal Traceback, most recent call last:
In src/main.pn:1:1
   |
 1 | (true second -&gt; second) false &quot;Bananas!&quot;
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
In src/main.pn:1:2
   |
 1 | (true second -&gt; second) false &quot;Bananas!&quot;
   |  ^^^^
   |
Runtime Pattern Matching Error: The data 'false' does not match the expected data 'true'
</code></pre>
<p><em>Discard</em> is another simple pattern – it does nothing. It's most useful when used in conjunction with other patterns:</p>
<pre><code class="language-elm">-- to ensure an fruit has the type Banana:
banana: Banana _ = mystery_fruit

-- to ignore an item in a tuple:
(_, plays_tennis, height_in_feet) = (&quot;Juan Milan&quot;, true, 27.5)

-- to ignore a field on a record:
{ name: &quot;Isaac Clayton&quot;, age: _, skill } = isaac
</code></pre>
<p>A <em>label</em> is a name given to a type. Of course, names do not imply type safety, but they do do a darn good job most of the time:</p>
<pre><code class="language-elm">-- make a soft yellow banana:
banana = Banana (&quot;yellow&quot;, &quot;soft&quot;)

-- check that the banana flesh is soft:
if { Banana (_, flesh) = banana; flesh == &quot;soft&quot; } {
    print &quot;Delicioso!&quot;
}
</code></pre>
<p>Pattern matching on labels is used to <em>extract</em> the raw data that is used to construct that label.</p>
<p><em>Tuples</em> are fairly simple – we already covered them – so we'll cover records next. A record is a set of fields:</p>
<pre><code class="language-elm">-- define the Person type
type Person {
    name:  String,
    age:   Natural,
    skill, -- polymorphic over skill
}

-- Make a person. It's me!
isaac = Person {
    name:  &quot;Isaac Clayton&quot;,
    age:   16,
    skill: Wizard &quot;High enough ¯\_(ツ)_/¯&quot;,
}
</code></pre>
<p>Here's how you can pattern match on <code>isaac</code>:</p>
<pre><code class="language-elm">Person {
    -- aliasing field `name` as `full_name`
    name: full_name,
    -- `age` is ignored
    age: _,
    -- short for `skill: skill`
    skill,
} = isaac
</code></pre>
<p>Of course, the pattern after the field is a full pattern, and can be matched against further.</p>
<p><em>Is</em> is a type annotation:</p>
<pre><code>Banana (color, _): Banana (_, &quot;soft&quot;) = fruit
</code></pre>
<p>In this example, <code>color</code> will be bound if <code>fruit</code> is a <code>Banana</code> whose 1nd† tuple item is <code>&quot;soft&quot;</code>.</p>
<blockquote>
<p>† Read as 'firnd', corresponds to the 1-indexed <em>second</em> item. Zerost, firnd, secord, thirth, fourth, fifth...</p>
</blockquote>
<p>Finally, we'll address my favorite pattern, <em>where</em>. Where allows for arbitrary code check the validity of a pattern. This can go a long way. For example, let's define natural numbers in terms of integers:</p>
<pre><code class="language-elm">type Natural n: Integer | n &gt;= 0
</code></pre>
<p>This should be interpreted as:</p>
<blockquote>
<p>The type <code>Natural</code> is an <code>Integer</code> <code>n</code> where <code>n</code> is greater than <code>0</code>.</p>
</blockquote>
<p>With this definition in place:</p>
<pre><code class="language-elm">-- this is valid
seven = Natural 7

-- this is not
negative_six = Natural -6
</code></pre>
<p>Where clauses in patterns ensure that the underlying data of a type can never break an invariant. As you can imagine, this is more powerful than ensuring name-safety through type constructors.</p>
<blockquote>
<p>TODO: traits and impls.</p>
</blockquote>
<p>Pattern matching and algebraic data types allow for quickly building up and tearing down expressive data schemas. As data (and the transformation applied to it) are the core of any program, constructs for quickly building up and tearing down complex datatypes are an incredible tool for scripting expressive applications.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../core/function-application.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../core/fibers.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../core/function-application.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../core/fibers.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
